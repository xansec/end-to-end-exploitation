# Lab 0: Run extract75 in Mayhem with Docker

## Overview

This guide will show you how to package our target binary, `extract75`, and fuzz it with Mayhem.

**Time to complete**: About 5 minutes

## Before we begin!

If you haven't already, create a new account by navigating to
[app.mayhem.security](https://app.mayhem.security) and either choose:
   * Sign up: Create a local account on the Mayhem instance.
   * SSO Sign-In: Use an identity broker such as Google or Github to create your Mayhem account

![Mayhem Account Creation](../assets/images/account-creation.png)

Please install all of the [prerequisite binaries.](README.md)

Then, you'll need to make sure you're logged in to all of the right services.

1. Log into Github's container registry with:
```
docker login -u <your username> ghcr.io
```
This will prompt you for a password, you'll need to use your github token here, with repo, workflow, write:packages and delete:packages permissions. For more information on setting this up, see [our guide in hackathon resources.](https://github.com/mayhemheroes/hackathon-resources/blob/main/docker-intro.md#login-to-the-github-container-registry)

2. Log into Mayhem with:
```
export MAYHEM_URL="https://app.mayhem.security"
export MAYHEM_TOKEN=<your mayhem token>
mayhem login
```
If you don't have a Mayhem token, you can create one here: https://app.mayhem.security/-/settings/user/api-tokens
![API Token](../assets/images/api-token-locations.png)

## Step 1. Build Docker image

The first thing we need to do is build a Docker image for our extract75 binary. This should be a simple
matter of running `make` and copying the binary.

1. Look at the contents of the extract75 directory. Remove references to `errno`/be sure to `#include errno.h` where needed.
2. Create your Dockerfile (or peek at the solution)
3. From the root of this repository, run `docker build -t ghcr.io/<your username>/extract75 . -f mayhem/Dockerfile`

## Step 2. Upload your image

We need to push our image to Github's container registry, AND make it public in order to run.

1. Upload the image with `docker push ghcr.io/<your username>/extract75`
2. Change the github package permissions to public. This process is outlined at: https://github.com/mayhemheroes/hackathon-resources/blob/main/docker-intro.md#build-and-push-the-docker-image

## Step 3. Unleash Mayhem!

We'll need a Mayhemfile to run this target. While this is pretty straightforward, we'll also need to make sure the
`DFFPATH` variable is set (otherwise our binary will complain). You can use the Mayhemfile provided, or you can create one, like so:
```
project: extract75-docker
target: extract75
image: ghcr.io/<your username>/extract75:latest
duration: 600
cmds:
  - cmd: /extract75/src/extract75 @@
    env: { "DFFPATH":"/binaries" }
```

1. Change into the `mayhem/` directory.
2. Run `mayhem run .`
3. Navigate to your run link to see Mayhem in action!

![Mayhem in Action](../assets/images/extract75-docker.png)
